<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Falling Repelled Stars (p5.js)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/p5.min.js"></script>
    <style>
      html, body { margin:0; height:100%; overflow:hidden; background:#000; }
      #debug { position:fixed; left:8px; top:8px; color:#0f0; font:12px/1.2 monospace; }
    </style>
  </head>
  <body>
    <div id="debug"></div>
    <script>
      // ---------------- Tweakables ----------------
      const STAR_COUNT = 120;
      const MIN_SIZE = 8;
      const MAX_SIZE = 22;
      const GRAVITY = 0.03;
      const WIND = 0.00;
      const REPULSION_RADIUS = 120;
      const REPULSION_STRENGTH = 2.0;
      const STAR_ALPHA = 0.55;   // transparency (0..1)
      const ROTATE_SLOWLY = true;

      // Color (HSB): green ~120; yellow ~55
      const STAR_HUE = 120;  // set to 55 for yellow

      class Star {
        constructor() { this.reset(true); }

        reset(randomY = false) {
          this.pos = createVector(random(width), randomY ? random(-height, height) : -random(50, 200));
          this.vel = createVector(random(-0.2, 0.2), random(0.6, 1.6));
          this.acc = createVector(0, 0);
          this.r = random(MIN_SIZE, MAX_SIZE);
          this.points = 5;
          this.innerRatio = random(0.45, 0.55);
          this.spin = (ROTATE_SLOWLY ? random(-0.01, 0.01) : 0);
          this.angle = random(TWO_PI);
          this.h = STAR_HUE + random(-6, 6);
        }

        applyForces() {
          this.acc.add(WIND, GRAVITY);

          // repel from mouse if inside canvas
          if (mouseX >= 0 && mouseX <= width && mouseY >= 0 && mouseY <= height) {
            const dir = createVector(this.pos.x - mouseX, this.pos.y - mouseY);
            const d = dir.mag();
            if (d > 0 && d < REPULSION_RADIUS) {
              const strength = REPULSION_STRENGTH * (1 - d / REPULSION_RADIUS) ** 2;
              dir.normalize().mult(strength);
              this.acc.add(dir);
            }
          }
        }

        update() {
          this.applyForces();
          this.vel.add(this.acc);
          this.pos.add(this.vel);
          this.acc.mult(0);
          if (ROTATE_SLOWLY) this.angle += this.spin;

          // reset when off bottom
          if (this.pos.y - this.r > height) this.reset(false);
          // wrap sides
          if (this.pos.x < -this.r) this.pos.x = width + this.r;
          if (this.pos.x > width + this.r) this.pos.x = -this.r;
        }

        draw() {
          push();
          translate(this.pos.x, this.pos.y);
          rotate(this.angle);
          noStroke();
          fill(this.h, 90, 100, STAR_ALPHA);
          drawStar(0, 0, this.r, this.r * this.innerRatio, this.points);
          pop();
        }
      }

      // Safer star routine: deterministic 2n vertices
      function drawStar(x, y, outerR, innerR, n) {
        beginShape();
        for (let i = 0; i < 2 * n; i++) {
          const useOuter = (i % 2 === 0);
          const r = useOuter ? outerR : innerR;
          const a = -HALF_PI + i * PI / n;
          vertex(x + cos(a) * r, y + sin(a) * r);
        }
        endShape(CLOSE);
      }

      let stars = [];
      let dbg;

      function setup() {
        createCanvas(windowWidth, windowHeight);
        colorMode(HSB, 360, 100, 100, 1);
        stars = Array.from({ length: STAR_COUNT }, () => new Star());
        dbg = document.getElementById('debug');
      }

      function draw() {
        // OPAQUE background for guaranteed contrast (black)
        background(0, 0, 0, 1);

        // repel radius visual
        if (mouseX >= 0 && mouseX <= width && mouseY >= 0 && mouseY <= height) {
          noFill();
          stroke(0, 0, 100, 0.1);
          circle(mouseX, mouseY, REPULSION_RADIUS * 2);
        }

        for (const s of stars) {
          s.update();
          s.draw();
        }

        // quick debug so you know it's running
        dbg.textContent = `stars: ${stars.length}  fps: ${nf(frameRate(),2,0)}`;
      }

      function windowResized() { resizeCanvas(windowWidth, windowHeight); }
    </script>
  </body>
</html>
